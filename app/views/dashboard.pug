doctype html
html
  head
    title Dashboard | Expenses Tracker
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    link(rel="stylesheet", href="/styles.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css", integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH", crossorigin="anonymous")
    style.
      body {
        background: #f0f2f5;
      }
      .app-navbar {
        background: linear-gradient(90deg, #0f172a, #0f766e);
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        border: none;
        padding: 12px 0;
      }
      .app-nav-inner {
        max-width: 1200px;
        margin: 0 auto;
        width: 94%;
        display: flex;
        align-items: center;
        gap: 16px;
      }
      .app-navbar .navbar-brand { color: #f8fafc; letter-spacing: 0.02em; }
      .app-navbar .nav-link { color: rgba(248, 250, 252, 0.88) !important; font-weight: 600; }
      .app-navbar .nav-link:hover { color: #fff !important; }
      .navbar-toggler { border-color: rgba(255,255,255,0.4); }
      .navbar-toggler-icon { filter: invert(1); }
      .app-navbar .navbar-brand {
        color: #f8fafc;
        letter-spacing: 0.02em;
      }
      .app-navbar .nav-link {
        color: rgba(248, 250, 252, 0.78);
        font-weight: 600;
      }
      .app-navbar .nav-link:hover {
        color: #fff;
      }
      .btn-logout {
        background: rgba(255,255,255,0.14);
        border-color: rgba(255,255,255,0.22);
        color: #fff;
      }
      .btn-logout:hover {
        background: rgba(255,255,255,0.22);
        color: #fff;
      }
      .container.dashboard {
        max-width: 1100px;
        width: 95%;
        margin: 30px auto;
        padding: 24px;
        box-sizing: border-box;
      }
      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      .dashboard-header h1 {
        margin: 0;
      }
      .dashboard-header p {
        margin: 6px 0 0;
        color: #555;
      }
      .btn {
        display: inline-block;
        padding: 10px 16px;
        background: #007bff;
        color: #fff;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
      }
      .btn:hover {
        background: #0056b3;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
      }
      .card {
        background: #fff;
        padding: 16px;
        border-radius: 10px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.06);
      }
      .card .label {
        font-size: 0.9rem;
        color: #666;
      }
      .card .value {
        display: block;
        margin-top: 8px;
        font-size: 1.6rem;
        font-weight: 700;
        color: #1c2434;
      }
      .section-title {
        margin: 6px 0 10px;
        font-size: 1.1rem;
      }
      .expenses-table {
        width: 100%;
        border-collapse: collapse;
      }
      .expenses-table th,
      .expenses-table td {
        padding: 10px 12px;
        text-align: left;
      }
      .expenses-table thead {
        background: #eef2f7;
      }
      .expenses-table tbody tr:nth-child(even) {
        background: #fafbfc;
      }
      .chip {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        background: #e9f3ff;
        color: #0b5ed7;
        font-size: 0.85rem;
      }
      .layout {
        display: grid;
        gap: 16px;
        grid-template-columns: 2fr 1fr;
      }
      .card form button {
        grid-column: 1 / -1;
        justify-self: flex-start;
      }
      .empty-state {
        color: #666;
        text-align: center;
        padding: 14px 0;
      }
      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
        }
        .dashboard-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }
      }

  body
    - var displayName = (user && user.name) || 'there';
    - var stats = summary || { monthTotal: 0, totalExpenses: 0, categories: 0, avgPerDay: 0 };
    - var categoryTotals = Array.isArray(categoryBreakdown) ? categoryBreakdown : [];
    - var expenseItems = Array.isArray(expenses) ? expenses : [];
    - var formatMoney = function(value) {
    -   var symbol = '£';
    -   if (typeof value === 'number') return symbol + value.toFixed(2);
    -   if (!value && value !== 0) return symbol + '0.00';
    -   var num = Number(value);
    -   return Number.isNaN(num) ? value : symbol + num.toFixed(2);
    - };
    - var today = new Date().toISOString().slice(0,10);

    include navbar

    .container.dashboard
      .dashboard-header
        div
          h1 Expenses Dashboard
          p Hello #{displayName}, keep an eye on your spending.
        a.btn(href="/logout") Logout

      .grid
        .card
          span.label Spent this month
          span.value= formatMoney(stats.monthTotal)
        .card
          span.label Total recorded
          span.value= formatMoney(stats.totalExpenses)
        .card
          span.label Categories tracked
          span.value= (stats.categories || categoryTotals.length)
        .card
          span.label Average per day
          span.value= formatMoney(stats.avgPerDay)

      .layout
        .card
          h2.section-title Recent expenses
          table.expenses-table
            thead
              tr
                th Date
                th Category
                th Description
                th Amount
            tbody
              each expense in expenseItems
                tr.clickable-row(data-href=`/expenses/${expense.id || ''}`)
                  td= expense.spent_at || '—'
                  td
                    if expense.category
                      span.chip= expense.category
                    else
                      | —
                  td= expense.description || '—'
                  td= formatMoney(expense.amount)
              else
                tr
                  td(colspan="4").empty-state No expenses yet. Add your first expense to start tracking.

        .card
          h2.section-title Category breakdown
          if categoryTotals.length
            each category in categoryTotals
              .list-item(style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f1f1f1;")
                span= category.name
                strong= formatMoney(category.total)
          else
            p.empty-state No categories yet. Create one when you add an expense.

      .card
        h2.section-title Quick add expense
        form(action="/expenses" method="POST" class="row gy-3 gx-2 align-items-end")
          .col-12.col-md-3
            label.form-label(for="amount") Amount
            input#amount.form-control(type="number" name="amount" step="0.01" min="0" required placeholder="0.00")
          .col-12.col-md-3
            label.form-label(for="category") Category
            select#category.form-select(name="category_id" required)
              option(value="" disabled selected) Choose a category
              each category in categoryTotals
                option(value=category.id || category.name)= category.name
              option(value="other") Other / New
          .col-12.col-md-4
            label.form-label(for="description") Description
            input#description.form-control(type="text" name="description" placeholder="What was this for?")
          .col-12.col-md-2
            label.form-label(for="spent_at") Date
            input#spent_at.form-control(type="date" name="spent_at" required value=today)
          .col-12
            button.btn.btn-primary.btn-lg.w-100(type="submit") Add expense

    script.
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.clickable-row[data-href]').forEach(function(row) {
          row.style.cursor = 'pointer';
          row.addEventListener('click', function() {
            var href = this.getAttribute('data-href');
            if (href) window.location.href = href;
          });
        });
      });
